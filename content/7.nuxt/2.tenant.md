---
title: Nuxtå¤šç§Ÿæˆ·æ¶æ„æŒ‡å—
navigation:
  icon: i-lucide-building
---

## ğŸ—ï¸ æ¶æ„æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨**åŸŸååŒºåˆ†ç§Ÿæˆ·**çš„å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡ã€‚åŒä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨åŒä¸€ä¸ª Node.js è¿›ç¨‹ä¸­ï¼Œé€šè¿‡ä¸åŒåŸŸåæ¥è¯†åˆ«å’Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„æ•°æ®å’Œé…ç½®ã€‚

## ğŸ¯ åŸŸååˆ°ç§Ÿæˆ·çš„æ˜ å°„

### åŸŸåé…ç½®ï¼ˆ`constants/site-type.ts`ï¼‰

```typescript
/**
 * é»˜è®¤ site-type
 */
export const DEFAULT_SITE_TYPE = 'default'  // ç«™ç‚¹ç±»å‹
export const DEFAULT_THEME = 'default'      // ç«™ç‚¹ä¸»é¢˜
export const DEFAULT_TENANT_ID = 'T0001'    // ç§Ÿæˆ·æ ‡è¯†
/**
 * åŸŸååˆ° site-type çš„æ˜ å°„é…ç½®
 */
export const DOMAIN_TO_SITE_TYPE_MAP: Record<string, string> = Object.freeze({
  'dev.chinamarket.cn': 'default',
  'global-dev.chinamarket.cn': 'english',
  'global.chinamarket.cn': 'english',
  'baigou-dev.chinamarket.cn': 'baigou',
  'baigou.chinamarket.cn': 'baigou',
})
/**
 * ç§Ÿæˆ·IDæ˜ å°„
 * @param default ä¸»ç«™
 * @param english è‹±æ–‡ç«™
 * @param baigou ç™½æ²Ÿç§Ÿæˆ·
 */
export const TENANT_ID_MAP: Record<string, string> = {
  'default': 'T0001',
  'english': 'T0001',
  'baigou': 'T0002',
} as const

/**
 * ä¸»é¢˜æ˜ å°„
 * @param default é»˜è®¤ä¸»é¢˜
 * @param english è‹±æ–‡ä¸»é¢˜
 * @param baigou ç™½æ²Ÿä¸»é¢˜
 */
export const THEME_MAP: Record<string, string> = {
  'default': 'default',
  'english': 'english',
  'baigou': 'dark',
} as const
```

## è¯·æ±‚éš”ç¦»æœºåˆ¶

```
æ—¶é—´ T1: ç”¨æˆ·Aè®¿é—® baigou.chinamarket.cn â†’ 'T0002'
æ—¶é—´ T2: ç”¨æˆ·Bè®¿é—® dev.chinamarket.cn â†’ 'T0001'
```

### ä½¿ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡éš”ç¦»

```typescript
// æœåŠ¡ç«¯ï¼šä½¿ç”¨äº‹ä»¶ä¸Šä¸‹æ–‡ï¼ˆevent.contextï¼‰æ¥éš”ç¦»ä¸åŒè¯·æ±‚
if (import.meta.server) {
  const event = useRequestEvent()
  
  // æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„ event.context
  if (!event.context.siteType || !event.context.siteTypeInfo) {
    const { siteType, siteTypeInfo } = getSiteTypeByHostname(event.node.req.headers.host || '')
    // å­˜å‚¨åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿åŒä¸€ä¸ªè¯·æ±‚å†…å…±äº«
    event.context.siteType = siteType
    event.context.siteTypeInfo = siteTypeInfo
  }}
  
  const siteType = computed(() => event.context.siteType || DEFAULT_SITE_TYPE)
  const siteTypeInfo = computed(() => event.context.siteTypeInfo || { theme: DEFAULT_THEME, tenantId: DEFAULT_TENANT_ID })
  return {
    siteType: readonly(siteType),
    siteTypeInfo: readonly(siteTypeInfo),
  }
}

// å®¢æˆ·ç«¯ï¼šä½¿ç”¨ useStateï¼Œå®¢æˆ·ç«¯ä¸å­˜åœ¨å¤šè¯·æ±‚å¹¶å‘é—®é¢˜
const siteType = useState<string>('site-type', () => DEFAULT_SITE_TYPE)
const siteTypeInfo = useState<SiteTypeInfo>('site-type-info', () => ({
  theme: DEFAULT_THEME,
  tenantId: DEFAULT_TENANT_ID,
})))
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. `useSiteType()` Composable

**æœåŠ¡ç«¯è¡Œä¸ºï¼š**
- ä½¿ç”¨ `event.context` å­˜å‚¨ç§Ÿæˆ·ä¿¡æ¯
- æ¯ä¸ª HTTP è¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„ context
- ä»è¯·æ±‚å¤´çš„ `host` è·å–åŸŸå
- æ ¹æ®åŸŸåæ˜ å°„è·å–ç§Ÿæˆ·ä¿¡æ¯

**å®¢æˆ·ç«¯è¡Œä¸ºï¼š**
- ä½¿ç”¨ `useState` å…±äº«çŠ¶æ€ï¼ˆå®¢æˆ·ç«¯å•ç”¨æˆ·ç¯å¢ƒï¼‰
- ä» `window.location.hostname` è·å–åŸŸå
- ä» Cookie è¯»å–æœåŠ¡ç«¯è®¾ç½®çš„ç§Ÿæˆ·ä¿¡æ¯

### 2. `site-type.global.ts` Middleware

**èŒè´£ï¼š**
1. **æœåŠ¡ç«¯**ï¼šä» hostname è®¡ç®—ç§Ÿæˆ·ä¿¡æ¯ï¼Œå­˜å‚¨åˆ° event.context å’Œ Cookie
2. **å®¢æˆ·ç«¯**ï¼šä» Cookie è¯»å–ç§Ÿæˆ·ä¿¡æ¯ï¼Œè®¾ç½®åˆ°å…¨å±€çŠ¶æ€

**æ‰§è¡Œæµç¨‹ï¼š**
```
è¯·æ±‚åˆ°è¾¾
  â†“
[æœåŠ¡ç«¯] Middleware æ‰§è¡Œ
  â†’ è·å– hostname
  â†’ è®¡ç®— siteType å’Œ siteTypeInfo
  â†’ å­˜å‚¨åˆ° event.context
  â†’ å†™å…¥ Cookie
  â†“
[å®¢æˆ·ç«¯] Hydration
  â†’ ä» Cookie è¯»å–ç§Ÿæˆ·ä¿¡æ¯
  â†’ è®¾ç½®åˆ° useState
  â†’ è®¾ç½® HTML å±æ€§ site-type
```

## ğŸ§ª æœ¬åœ°å¼€å‘æµ‹è¯•

ä½¿ç”¨ç¯å¢ƒå˜é‡æ¨¡æ‹Ÿä¸åŒåŸŸåï¼š

```bash
# .env
NUXT_PUBLIC_MOCK_HOSTNAME=baigou-dev.chinamarket.cn
```

è¿™æ ·åœ¨ localhost:5100 å¼€å‘æ—¶å¯ä»¥æ¨¡æ‹Ÿä¸åŒç§Ÿæˆ·ç¯å¢ƒã€‚

## ğŸ“Š ç§Ÿæˆ·æ•°æ®éš”ç¦»ç­–ç•¥

### API è¯·æ±‚éš”ç¦»

åœ¨ API è¯·æ±‚ä¸­è‡ªåŠ¨å¸¦ä¸ŠRefererå¤´ï¼ŒæœåŠ¡å™¨ç«¯æ ¹æ®Refererå¤´è·å–ç§Ÿæˆ·ä¿¡æ¯ã€‚

### æ ·å¼ä¸»é¢˜éš”ç¦»

```vue
<template>
  <!-- HTML ä¼šè‡ªåŠ¨è®¾ç½® site-type å±æ€§ -->
  <div>{{ content }}</div>
</template>

<style scoped>
/* æ ¹æ®ä¸åŒ site-type åº”ç”¨ä¸åŒæ ·å¼ */
:root[site-type="default"] .content {
  color: blue;
}

:root[site-type="baigou"] .content {
  color: red;
}
</style>
```

### æŸ¥çœ‹å½“å‰ç§Ÿæˆ·ä¿¡æ¯

```vue
<script setup>
const { siteType, tenantId, tenantTheme } = useSiteType()

console.log('Site Type:', siteType.value)
console.log('Tenant ID:', tenantId.value)
console.log('Theme:', tenantTheme.value)
</script>
```

## æ‰©å±•ç§Ÿæˆ·

æ·»åŠ æ–°ç§Ÿæˆ·åªéœ€ä¸‰æ­¥ï¼š

1. **é…ç½®åŸŸåæ˜ å°„**ï¼ˆ`constants/site-type.ts`ï¼‰
   ```typescript
   DOMAIN_TO_SITE_TYPE_MAP['newsite.chinamarket.cn'] = 'newsite'
   ```

2. **é…ç½®ç§Ÿæˆ·ä¿¡æ¯**
   ```typescript
   TENANT_ID_MAP['newsite'] = 'T0003'
   THEME_MAP['newsite'] = 'custom-theme'
   ```

å®Œæˆï¼æ–°ç§Ÿæˆ·è‡ªåŠ¨ç”Ÿæ•ˆã€‚