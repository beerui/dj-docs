---
title: Nuxtå¤šç§Ÿæˆ·æ¶æ„æŒ‡å—
---

## ğŸ—ï¸ æ¶æ„æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨**åŸŸååŒºåˆ†ç§Ÿæˆ·**çš„å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡ã€‚åŒä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨åŒä¸€ä¸ª Node.js è¿›ç¨‹ä¸­ï¼Œé€šè¿‡ä¸åŒåŸŸåæ¥è¯†åˆ«å’Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„æ•°æ®å’Œé…ç½®ã€‚

## ğŸ¯ åŸŸååˆ°ç§Ÿæˆ·çš„æ˜ å°„

### åŸŸåé…ç½®ï¼ˆ`constants/site-type.ts`ï¼‰

```typescript
/**
 * é»˜è®¤ site-type
 */
export const DEFAULT_SITE_TYPE = 'default'
export const DEFAULT_THEME = 'default'
export const DEFAULT_TENANT_ID = 'T0001'
/**
 * åŸŸååˆ° site-type çš„æ˜ å°„é…ç½®
 * tenant-theme="white"
 * tenant-id="1"
 */
export const DOMAIN_TO_SITE_TYPE_MAP: Record<string, string> = Object.freeze({
  'dev.chinamarket.cn': 'default',
  'global-dev.chinamarket.cn': 'english',
  'global.chinamarket.cn': 'english',
  'baigou-dev.chinamarket.cn': 'baigou',
  'baigou.chinamarket.cn': 'baigou',
})
/**
 * ç§Ÿæˆ·IDæ˜ å°„
 * @param default ä¸»ç«™
 * @param english è‹±æ–‡ç«™
 * @param baigou ç™½æ²Ÿç§Ÿæˆ·
 */
export const TENANT_ID_MAP: Record<string, string> = {
  'default': 'T0001',
  'english': 'T0001',
  'baigou': 'T0002',
} as const

/**
 * ä¸»é¢˜æ˜ å°„
 * @param default é»˜è®¤ä¸»é¢˜
 * @param english è‹±æ–‡ä¸»é¢˜
 * @param baigou ç™½æ²Ÿä¸»é¢˜
 */
export const THEME_MAP: Record<string, string> = {
  'default': 'default',
  'english': 'english',
  'baigou': 'dark',
} as const
```

## ğŸ”’ è¯·æ±‚éš”ç¦»æœºåˆ¶

### âš ï¸ å…³é”®é—®é¢˜ï¼šuseState åœ¨å¤šç§Ÿæˆ·åœºæ™¯ä¸‹çš„é™·é˜±

**é”™è¯¯åšæ³•ï¼ˆä¼šå¯¼è‡´ç§Ÿæˆ·æ•°æ®æ±¡æŸ“ï¼‰ï¼š**

```typescript
// âŒ è¿™ç§æ–¹å¼åœ¨æœåŠ¡ç«¯ä¼šå¯¼è‡´ä¸åŒè¯·æ±‚å…±äº«åŒä¸€ä¸ªçŠ¶æ€
const siteType = useState('site-type', () => 'default')
```

**é—®é¢˜åœºæ™¯ï¼š**
```
æ—¶é—´ T1: ç”¨æˆ·Aè®¿é—® baigou.chinamarket.cn â†’ setState('T0002')
æ—¶é—´ T2: ç”¨æˆ·Bè®¿é—® dev.chinamarket.cn â†’ setState('T0001')
æ—¶é—´ T3: ç”¨æˆ·Açš„ç»„ä»¶æ¸²æŸ“ â†’ è¯»å–åˆ° 'T0001' âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ 'T0002'
```

### âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡éš”ç¦»

```typescript
// æœåŠ¡ç«¯ï¼šä½¿ç”¨äº‹ä»¶ä¸Šä¸‹æ–‡ï¼ˆevent.contextï¼‰æ¥éš”ç¦»ä¸åŒè¯·æ±‚
if (import.meta.server) {
  const event = useRequestEvent()
  
  // æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„ event.context
  if (!event.context.siteType) {
    const hostname = event.node.req.headers.host
    event.context.siteType = getSiteTypeByHostname(hostname)
  }
  
  return {
    siteType: computed(() => event.context.siteType)
  }
}

// å®¢æˆ·ç«¯ï¼šä½¿ç”¨ useStateï¼ˆå®¢æˆ·ç«¯ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ï¼‰
const siteType = useState('site-type', () => 'default')
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. `useSiteType()` Composable

**æœåŠ¡ç«¯è¡Œä¸ºï¼š**
- ä½¿ç”¨ `event.context` å­˜å‚¨ç§Ÿæˆ·ä¿¡æ¯
- æ¯ä¸ª HTTP è¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„ context
- ä»è¯·æ±‚å¤´çš„ `host` è·å–åŸŸå
- æ ¹æ®åŸŸåæ˜ å°„è·å–ç§Ÿæˆ·ä¿¡æ¯

**å®¢æˆ·ç«¯è¡Œä¸ºï¼š**
- ä½¿ç”¨ `useState` å…±äº«çŠ¶æ€ï¼ˆå®¢æˆ·ç«¯å•ç”¨æˆ·ç¯å¢ƒï¼‰
- ä» `window.location.hostname` è·å–åŸŸå
- ä» Cookie è¯»å–æœåŠ¡ç«¯è®¾ç½®çš„ç§Ÿæˆ·ä¿¡æ¯

### 2. `site-type.global.ts` Middleware

**èŒè´£ï¼š**
1. **æœåŠ¡ç«¯**ï¼šä» hostname è®¡ç®—ç§Ÿæˆ·ä¿¡æ¯ï¼Œå­˜å‚¨åˆ° event.context å’Œ Cookie
2. **å®¢æˆ·ç«¯**ï¼šä» Cookie è¯»å–ç§Ÿæˆ·ä¿¡æ¯ï¼Œè®¾ç½®åˆ°å…¨å±€çŠ¶æ€

**æ‰§è¡Œæµç¨‹ï¼š**
```
è¯·æ±‚åˆ°è¾¾
  â†“
[æœåŠ¡ç«¯] Middleware æ‰§è¡Œ
  â†’ è·å– hostname
  â†’ è®¡ç®— siteType å’Œ siteTypeInfo
  â†’ å­˜å‚¨åˆ° event.context
  â†’ å†™å…¥ Cookie
  â†“
[å®¢æˆ·ç«¯] Hydration
  â†’ ä» Cookie è¯»å–ç§Ÿæˆ·ä¿¡æ¯
  â†’ è®¾ç½®åˆ° useState
  â†’ è®¾ç½® HTML å±æ€§ site-type
```

## ğŸ§ª æœ¬åœ°å¼€å‘æµ‹è¯•

ä½¿ç”¨ç¯å¢ƒå˜é‡æ¨¡æ‹Ÿä¸åŒåŸŸåï¼š

```bash
# .env
NUXT_PUBLIC_DEV_MODE=true
NUXT_PUBLIC_MOCK_HOSTNAME=baigou-dev.chinamarket.cn
```

è¿™æ ·åœ¨ localhost:3000 å¼€å‘æ—¶å¯ä»¥æ¨¡æ‹Ÿä¸åŒç§Ÿæˆ·ç¯å¢ƒã€‚

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å•åº”ç”¨å¤šåŸŸåéƒ¨ç½²

**Nginx é…ç½®ç¤ºä¾‹ï¼š**

```nginx
server {
    listen 80;
    server_name dev.chinamarket.cn global-dev.chinamarket.cn baigou-dev.chinamarket.cn;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**å…³é”®ç‚¹ï¼š**
- `proxy_set_header Host $host` ç¡®ä¿ Node.js åº”ç”¨èƒ½è·å–åˆ°æ­£ç¡®çš„åŸŸå
- æ‰€æœ‰åŸŸåæŒ‡å‘åŒä¸€ä¸ªåº”ç”¨å®ä¾‹
- åº”ç”¨æ ¹æ® `Host` è¯·æ±‚å¤´è‡ªåŠ¨è¯†åˆ«ç§Ÿæˆ·

## ğŸ“Š ç§Ÿæˆ·æ•°æ®éš”ç¦»ç­–ç•¥

### 1. API è¯·æ±‚éš”ç¦»

```typescript
// åœ¨ API è¯·æ±‚ä¸­è‡ªåŠ¨å¸¦ä¸Šç§Ÿæˆ·ID
const { tenantId } = useSiteType()

const data = await $fetch('/api/products', {
  headers: {
    'X-Tenant-ID': tenantId.value
  }
})
```

### 2. æ•°æ®åº“æŸ¥è¯¢éš”ç¦»

```typescript
// æœåŠ¡ç«¯ API è·¯ç”±ä¸­è·å–ç§Ÿæˆ·ä¿¡æ¯
export default defineEventHandler(async (event) => {
  const tenantId = event.context.tenantId
  
  // æ‰€æœ‰æŸ¥è¯¢éƒ½å¸¦ä¸Šç§Ÿæˆ·è¿‡æ»¤æ¡ä»¶
  const products = await db.products.find({ tenantId })
  
  return products
})
```

### 3. æ ·å¼ä¸»é¢˜éš”ç¦»

```vue
<template>
  <!-- HTML ä¼šè‡ªåŠ¨è®¾ç½® site-type å±æ€§ -->
  <div>{{ content }}</div>
</template>

<style scoped>
/* æ ¹æ®ä¸åŒ site-type åº”ç”¨ä¸åŒæ ·å¼ */
:root[site-type="default"] .content {
  color: blue;
}

:root[site-type="baigou"] .content {
  color: red;
}
</style>
```

## âš¡ æ€§èƒ½è€ƒè™‘

### ä¼˜åŠ¿
- âœ… å•åº”ç”¨éƒ¨ç½²ï¼Œè¿ç»´æˆæœ¬ä½
- âœ… ä»£ç å¤ç”¨ç‡é«˜
- âœ… å†…å­˜å ç”¨å°ï¼ˆå…±äº« Node.js è¿›ç¨‹ï¼‰

### æ³¨æ„äº‹é¡¹
- âš ï¸ å¿…é¡»ä½¿ç”¨ `event.context` éš”ç¦»æœåŠ¡ç«¯çŠ¶æ€
- âš ï¸ é¿å…ä½¿ç”¨å…¨å±€å˜é‡å­˜å‚¨ç§Ÿæˆ·ä¿¡æ¯
- âš ï¸ ç¡®ä¿æ•°æ®åº“æŸ¥è¯¢éƒ½å¸¦ç§Ÿæˆ·è¿‡æ»¤æ¡ä»¶

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å½“å‰ç§Ÿæˆ·ä¿¡æ¯

```vue
<script setup>
const { siteType, tenantId, tenantTheme } = useSiteType()

console.log('Site Type:', siteType.value)
console.log('Tenant ID:', tenantId.value)
console.log('Theme:', tenantTheme.value)
</script>
```

### æ£€æŸ¥è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆæœåŠ¡ç«¯ï¼‰

```typescript
export default defineEventHandler((event) => {
  console.log('Event Context:', event.context)
  // { siteType: 'baigou', siteTypeInfo: { theme: 'dark', tenantId: 'T0002' } }
})
```

## ğŸ“ æœ€ä½³å®è·µ

1. **æ°¸è¿œä¸è¦åœ¨æœåŠ¡ç«¯ä½¿ç”¨ useState å­˜å‚¨è¯·æ±‚çº§åˆ«çš„æ•°æ®**
2. **ä½¿ç”¨ `event.context` åœ¨åŒä¸€è¯·æ±‚çš„ä¸åŒå¤„ç†é˜¶æ®µä¼ é€’æ•°æ®**
3. **åœ¨ä¸­é—´ä»¶ä¸­å°½æ—©è®¾ç½®ç§Ÿæˆ·ä¿¡æ¯**
4. **åœ¨ API è·¯ç”±ä¸­å§‹ç»ˆéªŒè¯ç§Ÿæˆ·æƒé™**
5. **åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ Cookie ä¿æŒç§Ÿæˆ·ä¿¡æ¯ä¸€è‡´æ€§**

## ğŸ“ æ‰©å±•ç§Ÿæˆ·

æ·»åŠ æ–°ç§Ÿæˆ·åªéœ€ä¸‰æ­¥ï¼š

1. **é…ç½®åŸŸåæ˜ å°„**ï¼ˆ`constants/site-type.ts`ï¼‰
   ```typescript
   DOMAIN_TO_SITE_TYPE_MAP['newsite.chinamarket.cn'] = 'newsite'
   ```

2. **é…ç½®ç§Ÿæˆ·ä¿¡æ¯**
   ```typescript
   TENANT_TO_SITE_TYPE_MAP['newsite'] = {
     theme: 'custom-theme',
     tenantId: 'T0003'
   }
   ```

3. **æ·»åŠ åŸŸåè§£æå’Œ Nginx é…ç½®**
   ```nginx
   server_name ... newsite.chinamarket.cn;
   ```

å®Œæˆï¼æ–°ç§Ÿæˆ·è‡ªåŠ¨ç”Ÿæ•ˆã€‚

# å…¨å±€ç§Ÿæˆ·ä¿¡æ¯ä½¿ç”¨æŒ‡å—

## ğŸ“¦ å¯ç”¨çš„å…¨å±€æ³¨å…¥

æ’ä»¶ `plugins/01.site-type.ts` æä¾›äº†ä»¥ä¸‹å…¨å±€æ³¨å…¥ï¼š

- `$tenantId` - å½“å‰ç§Ÿæˆ· IDï¼ˆå¦‚ 'T0001', 'T0002'ï¼‰
- `$tenantTheme` - å½“å‰ç§Ÿæˆ·ä¸»é¢˜ï¼ˆå¦‚ 'default', 'dark', 'english'ï¼‰
- `$siteType` - å½“å‰ç«™ç‚¹ç±»å‹ï¼ˆå¦‚ 'default', 'baigou'ï¼‰
- `$siteTypeInfo` - å®Œæ•´çš„ç«™ç‚¹ç±»å‹ä¿¡æ¯å¯¹è±¡

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1ï¼šåœ¨ç»„åˆå¼ API ä¸­ä½¿ç”¨ï¼ˆæ¨èï¼‰

#### æ–¹æ³• Aï¼šä½¿ç”¨ `useNuxtApp()`

```vue
<script setup lang="ts">
const { $tenantId, $tenantTheme, $siteType, $siteTypeInfo } = useNuxtApp()

// æ³¨æ„ï¼šé€šè¿‡ useNuxtApp() è·å–çš„æ˜¯ ComputedRefï¼Œéœ€è¦ .value è®¿é—®
console.log('ç§Ÿæˆ·ID:', $tenantId.value)
console.log('ç§Ÿæˆ·ä¸»é¢˜:', $tenantTheme.value)
console.log('ç«™ç‚¹ç±»å‹:', $siteType.value)
console.log('å®Œæ•´ä¿¡æ¯:', $siteTypeInfo.value)

// åœ¨æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£åŒ…ï¼Œä¸éœ€è¦ .value
</script>

<template>
  <div>
    <p>ç§Ÿæˆ· ID: {{ $tenantId }}</p>
    <p>ç§Ÿæˆ·ä¸»é¢˜: {{ $tenantTheme }}</p>
    <p>ç«™ç‚¹ç±»å‹: {{ $siteType }}</p>
  </div>
</template>
```

#### æ–¹æ³• Bï¼šä½¿ç”¨ `useSiteType()` composableï¼ˆæ›´æ¨èï¼‰

```vue
<script setup lang="ts">
const { tenantId, tenantTheme, siteType, siteTypeInfo } = useSiteType()

console.log('ç§Ÿæˆ·ID:', tenantId.value)
console.log('ç§Ÿæˆ·ä¸»é¢˜:', tenantTheme.value)
</script>

<template>
  <div>
    <p>ç§Ÿæˆ· ID: {{ tenantId }}</p>
    <p>ç§Ÿæˆ·ä¸»é¢˜: {{ tenantTheme }}</p>
  </div>
</template>
```

### æ–¹å¼ 2ï¼šåœ¨é€‰é¡¹å¼ API ä¸­ä½¿ç”¨

```vue
<script>
export default {
  mounted() {
    // é€šè¿‡ this è®¿é—®å…¨å±€å±æ€§ï¼ˆå·²è‡ªåŠ¨è§£åŒ…ï¼Œç›´æ¥æ˜¯å€¼ï¼‰
    console.log('ç§Ÿæˆ·ID:', this.$tenantId)
    console.log('ç§Ÿæˆ·ä¸»é¢˜:', this.$tenantTheme)
  },
  
  computed: {
    currentTenantId() {
      // å…¨å±€å±æ€§å·²ç»æ˜¯åŸå§‹å€¼ï¼Œä¸éœ€è¦ .value
      return this.$tenantId
    }
  }
}
</script>

<template>
  <div>
    <!-- åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ -->
    <p>ç§Ÿæˆ· ID: {{ $tenantId }}</p>
    <p>ç§Ÿæˆ·ä¸»é¢˜: {{ $tenantTheme }}</p>
  </div>
</template>
```

### æ–¹å¼ 3ï¼šåœ¨æœåŠ¡ç«¯ API è·¯ç”±ä¸­ä½¿ç”¨

```typescript
// server/api/products.ts
export default defineEventHandler(async (event) => {
  // ä»äº‹ä»¶ä¸Šä¸‹æ–‡è·å–ç§Ÿæˆ·ä¿¡æ¯
  const tenantId = event.context.siteTypeInfo?.tenantId || 'T0001'
  const siteType = event.context.siteType || 'default'
  
  console.log('API è¯·æ±‚çš„ç§Ÿæˆ·ID:', tenantId)
  
  // æ ¹æ®ç§Ÿæˆ·è¿‡æ»¤æ•°æ®
  const products = await db.products.find({ 
    tenantId: tenantId 
  })
  
  return {
    tenantId,
    siteType,
    products
  }
})
```

### æ–¹å¼ 4ï¼šåœ¨ä¸­é—´ä»¶ä¸­ä½¿ç”¨

```typescript
// middleware/check-tenant.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const { tenantId } = useSiteType()
  
  // æ ¹æ®ç§Ÿæˆ·é™åˆ¶è®¿é—®
  if (tenantId.value === 'T0002' && to.path.startsWith('/admin')) {
    return navigateTo('/')
  }
})
```

### æ–¹å¼ 5ï¼šåœ¨ Pinia Store ä¸­ä½¿ç”¨

```typescript
// stores/user.ts
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', () => {
  const { tenantId, tenantTheme } = useSiteType()
  
  const fetchUserData = async () => {
    const data = await $fetch('/api/user', {
      headers: {
        'X-Tenant-ID': tenantId.value
      }
    })
    return data
  }
  
  return {
    tenantId,
    tenantTheme,
    fetchUserData
  }
})
```

### æ–¹å¼ 6ï¼šåœ¨å·¥å…·å‡½æ•°ä¸­ä½¿ç”¨

```typescript
// utils/api.ts
export function useTenantApi() {
  const { tenantId } = useSiteType()
  
  const fetchWithTenant = async (url: string, options = {}) => {
    return $fetch(url, {
      ...options,
      headers: {
        'X-Tenant-ID': tenantId.value,
        ...options.headers,
      }
    })
  }
  
  return {
    fetchWithTenant
  }
}

// ä½¿ç”¨
const { fetchWithTenant } = useTenantApi()
const data = await fetchWithTenant('/api/products')
```

## ğŸ¨ åœ¨ CSS ä¸­ä½¿ç”¨

HTML å±æ€§ä¼šè‡ªåŠ¨è®¾ç½®ï¼Œå¯ä»¥åœ¨ CSS ä¸­ä½¿ç”¨ï¼š

```vue
<style scoped>
/* æ ¹æ®ç§Ÿæˆ· ID åº”ç”¨ä¸åŒæ ·å¼ */
:root[tenant-id="T0001"] .header {
  background-color: #1890ff;
}

:root[tenant-id="T0002"] .header {
  background-color: #722ed1;
}

/* æ ¹æ®ç§Ÿæˆ·ä¸»é¢˜åº”ç”¨æ ·å¼ */
:root[tenant-theme="dark"] {
  --primary-color: #1f1f1f;
  --text-color: #ffffff;
}

:root[tenant-theme="default"] {
  --primary-color: #ffffff;
  --text-color: #000000;
}

/* æ ¹æ®ç«™ç‚¹ç±»å‹åº”ç”¨æ ·å¼ */
:root[site-type="baigou"] .logo {
  content: url('/images/logo-baigou.png');
}

:root[site-type="default"] .logo {
  content: url('/images/logo-default.png');
}
</style>
```

## ğŸ” æ¡ä»¶æ¸²æŸ“

### æ ¹æ®ç§Ÿæˆ· ID æ¡ä»¶æ¸²æŸ“

```vue
<template>
  <div>
    <!-- åªåœ¨ç‰¹å®šç§Ÿæˆ·æ˜¾ç¤º -->
    <div v-if="$tenantId === 'T0001'">
      è¿™æ˜¯é»˜è®¤ç§Ÿæˆ·çš„å†…å®¹
    </div>
    
    <div v-if="$tenantId === 'T0002'">
      è¿™æ˜¯ç™½æ²Ÿç§Ÿæˆ·çš„å†…å®¹
    </div>
    
    <!-- ä½¿ç”¨å·¥å…·å‡½æ•° -->
    <div v-if="isTenant('T0001')">
      ä½¿ç”¨ isTenant å·¥å…·å‡½æ•°
    </div>
    
    <div v-if="isTenant(['T0001', 'T0002'])">
      å¤šä¸ªç§Ÿæˆ·éƒ½æ˜¾ç¤º
    </div>
  </div>
</template>

<script setup lang="ts">
import { isTenant } from '~/utils/business/nation'
const { $tenantId } = useNuxtApp()
</script>
```

### æ ¹æ®ä¸»é¢˜æ¡ä»¶æ¸²æŸ“

```vue
<template>
  <div>
    <DarkHeader v-if="$tenantTheme === 'dark'" />
    <LightHeader v-else />
  </div>
</template>

<script setup lang="ts">
const { $tenantTheme } = useNuxtApp()
</script>
```

## ğŸ“Š å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šç§Ÿæˆ·ç‰¹å®šçš„ API è¯·æ±‚

```vue
<script setup lang="ts">
const { $tenantId } = useNuxtApp()

// è‡ªåŠ¨å¸¦ä¸Šç§Ÿæˆ·ä¿¡æ¯
const { data: products } = await useFetch('/api/products', {
  headers: {
    'X-Tenant-ID': $tenantId.value
  }
})
</script>
```

### åœºæ™¯ 2ï¼šç§Ÿæˆ·ç‰¹å®šçš„è·¯ç”±è·³è½¬

```vue
<script setup lang="ts">
const { $tenantId } = useNuxtApp()

const goToProducts = () => {
  // æ ¹æ®ç§Ÿæˆ·è·³è½¬åˆ°ä¸åŒé¡µé¢
  if ($tenantId.value === 'T0001') {
    navigateTo('/products')
  } else if ($tenantId.value === 'T0002') {
    navigateTo('/baigou-products')
  }
}
</script>
```

### åœºæ™¯ 3ï¼šç§Ÿæˆ·ç‰¹å®šçš„é…ç½®

```typescript
// composables/useTenantConfig.ts
export const useTenantConfig = () => {
  const { tenantId } = useSiteType()
  
  const config = computed(() => {
    const configs = {
      'T0001': {
        logo: '/images/logo-default.png',
        primaryColor: '#1890ff',
        contactEmail: 'support@default.com'
      },
      'T0002': {
        logo: '/images/logo-baigou.png',
        primaryColor: '#722ed1',
        contactEmail: 'support@baigou.com'
      }
    }
    
    return configs[tenantId.value as keyof typeof configs] || configs['T0001']
  })
  
  return config
}

// ä½¿ç”¨
const config = useTenantConfig()
console.log(config.value.logo)
```

### åœºæ™¯ 4ï¼šç§Ÿæˆ·ç‰¹å®šçš„å›½é™…åŒ–

```vue
<script setup lang="ts">
const { $tenantId, $tenantTheme } = useNuxtApp()
const { locale } = useI18n()

// æ ¹æ®ç§Ÿæˆ·è®¾ç½®è¯­è¨€
watchEffect(() => {
  if ($tenantTheme.value === 'english') {
    locale.value = 'en'
  } else {
    locale.value = 'zh-CN'
  }
})
</script>
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å“åº”å¼è®¿é—®

æ ¹æ®è®¿é—®æ–¹å¼ä¸åŒï¼Œéœ€è¦æ³¨æ„æ˜¯å¦éœ€è¦ `.value`ï¼š

```typescript
// æ–¹å¼ 1ï¼šé€šè¿‡ useNuxtApp() - è¿”å› ComputedRefï¼Œéœ€è¦ .value
const { $tenantId } = useNuxtApp()
console.log($tenantId.value) // âœ… æ­£ç¡®

// æ–¹å¼ 2ï¼šé€šè¿‡ useSiteType() - è¿”å› ComputedRefï¼Œéœ€è¦ .value
const { tenantId } = useSiteType()
console.log(tenantId.value) // âœ… æ­£ç¡®

// æ–¹å¼ 3ï¼šåœ¨é€‰é¡¹å¼ API ä¸­ - å…¨å±€å±æ€§å·²è§£åŒ…ï¼Œç›´æ¥æ˜¯å€¼
export default {
  mounted() {
    console.log(this.$tenantId) // âœ… æ­£ç¡®ï¼Œä¸éœ€è¦ .value
  }
}
```

### 2. æ¨¡æ¿ä¸­è‡ªåŠ¨è§£åŒ…

åœ¨ Vue æ¨¡æ¿ä¸­ï¼Œå“åº”å¼å˜é‡ä¼šè‡ªåŠ¨è§£åŒ…ï¼š

```vue
<template>
  <!-- âœ… æ­£ç¡® - è‡ªåŠ¨è§£åŒ… -->
  <div>{{ $tenantId }}</div>
  
  <!-- âŒ ä¸éœ€è¦ .value -->
  <div>{{ $tenantId.value }}</div>
</template>
```

### 3. æœåŠ¡ç«¯ä½¿ç”¨äº‹ä»¶ä¸Šä¸‹æ–‡

åœ¨æœåŠ¡ç«¯ API è·¯ç”±ä¸­ï¼Œåº”è¯¥ä» `event.context` è·å–ï¼š

```typescript
// âœ… æ­£ç¡®
export default defineEventHandler((event) => {
  const tenantId = event.context.siteTypeInfo?.tenantId
})

// âŒ é”™è¯¯ - ä¸è¦åœ¨æœåŠ¡ç«¯ API ä¸­ä½¿ç”¨ useSiteType
export default defineEventHandler(() => {
  const { tenantId } = useSiteType() // å¯èƒ½å¯¼è‡´çŠ¶æ€æ±¡æŸ“
})
```

### 4. æ¨èçš„ä½¿ç”¨æ–¹å¼

| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|------|---------|------|
| Vue ç»„ä»¶ | `useSiteType()` | ç±»å‹å®‰å…¨ï¼Œè¯­ä¹‰æ¸…æ™° |
| æ¨¡æ¿ç›´æ¥è®¿é—® | `$tenantId` | ç®€æ´æ–¹ä¾¿ |
| API è·¯ç”± | `event.context` | é¿å…çŠ¶æ€æ±¡æŸ“ |
| å·¥å…·å‡½æ•° | `useSiteType()` | å‡½æ•°å¼ï¼Œå¯æµ‹è¯• |

## ğŸ“ æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ `useSiteType()` composable**ï¼šæä¾›å®Œæ•´ç±»å‹æ”¯æŒå’Œæ›´å¥½çš„å¯æµ‹è¯•æ€§
2. **åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ `$tenantId`**ï¼šç®€æ´æ–¹ä¾¿ï¼Œé€‚åˆå¿«é€Ÿè®¿é—®
3. **åœ¨ API è·¯ç”±ä¸­ä½¿ç”¨ `event.context`**ï¼šç¡®ä¿è¯·æ±‚éš”ç¦»ï¼Œé¿å…çŠ¶æ€æ±¡æŸ“
4. **å°è£…ä¸šåŠ¡é€»è¾‘**ï¼šåˆ›å»º `useTenantConfig()` ç­‰ composable å°è£…ç§Ÿæˆ·ç›¸å…³é€»è¾‘
5. **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ TypeScript ç±»å‹ç³»ç»Ÿç¡®ä¿ç§Ÿæˆ· ID çš„æ­£ç¡®æ€§

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¤šç§Ÿæˆ·æ¶æ„è¯´æ˜](./.cursor/docs/multi-tenant-architecture.md)
- [useSiteType Composable](../composables/useSiteType.ts)
- [ç§Ÿæˆ·å·¥å…·å‡½æ•°](../utils/business/nation.ts)

