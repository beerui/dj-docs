---
title: 客服重定向页面方案
navigation:
  icon: i-lucide-terminal
---

## 客服二开卡片重定向

- 聊天信息中的商品卡片跳转页面，需要根据用户所在端打开不同的地址。
- 项目`trade-exhibition-mobile`
- 重定向页面跳转地址：
- 重定向页面存储位置：

```ts
const defaultDomain = 'www.chinamarket.cn'
const getChinamarketUrls = (envType) => {
  let baseUrlH5 = 'https://dev-h5.chinamarket.cn'
  let baseUrlPc = 'https://dev.chinamarket.cn'
  let baseUrlAdmin = 'https://dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlH5 = 'https://staging-h5.chinamarket.cn'
    baseUrlPc = 'https://staging.chinamarket.cn'
    baseUrlAdmin = 'https://staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlH5 = 'https://m.chinamarket.cn'
    baseUrlPc = 'https://www.chinamarket.cn'
    baseUrlAdmin = 'https://admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    h5: {
      order: `${baseUrlH5}/pages-sub/order/order-detail`,
      detail: `${baseUrlH5}/pages-sub/product-details/index`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const getBaigouUrls = (envType) => {
  let baseUrlPc = 'https://baigou-dev.chinamarket.cn'
  let baseUrlAdmin = 'https://baigou-dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlPc = 'https://baigou-staging.chinamarket.cn'
    baseUrlAdmin = 'https://baigou-staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlPc = 'https://baigou.chinamarket.cn'
    baseUrlAdmin = 'https://baigou-admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const getIdnUrls = (envType) => {
  let baseUrlPc = 'https://idn-dev.chinamarket.cn'
  let baseUrlH5 = 'https://idn-dev-m.chinamarket.cn'
  let baseUrlAdmin = 'https://dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlPc = 'https://staging-idn.chinamarket.cn'
    baseUrlH5 = 'https://idn-staging-m.chinamarket.cn'
    baseUrlAdmin = 'https://staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlPc = 'https://idn.chinamarket.cn'
    baseUrlH5 = 'https://idn-m.chinamarket.cn'
    baseUrlAdmin = 'https://admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    h5: {
      order: `${baseUrlH5}/pages-sub/order/order-detail`,
      detail: `${baseUrlH5}/pages-sub/product-details/index`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const getUaeUrls = (envType) => {
  let baseUrlPc = 'https://dev-uae.chinamarket.cn'
  let baseUrlH5 = 'https://uae-dev-m.chinamarket.cn'
  let baseUrlAdmin = 'https://dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlPc = 'https://uae-staging.chinamarket.cn'
    baseUrlH5 = 'https://uae-staging-m.chinamarket.cn'
    baseUrlAdmin = 'https://staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlPc = 'https://uae.chinamarket.cn'
    baseUrlH5 = 'https://uae-m.chinamarket.cn'
    baseUrlAdmin = 'https://admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    h5: {
      order: `${baseUrlH5}/pages-sub/order/order-detail`,
      detail: `${baseUrlH5}/pages-sub/product-details/index`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const getGlobalUrls = (envType) => {
  let baseUrlPc = 'https://global-dev.chinamarket.cn'
  let baseUrlAdmin = 'https://dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlPc = 'https://global-staging.chinamarket.cn'
    baseUrlAdmin = 'https://staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlPc = 'https://global.chinamarket.cn'
    baseUrlAdmin = 'https://admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const getHkUrls = (envType) => {
  let baseUrlPc = 'https://hk-dev.chinamarket.cn'
  let baseUrlAdmin = 'https://dev-admin.chinamarket.cn'
  if (envType === 'staging') {
    baseUrlPc = 'https://hk-staging.chinamarket.cn'
    baseUrlAdmin = 'https://staging-admin.chinamarket.cn'
  }
  if (envType === 'production') {
    baseUrlPc = 'https://hk.chinamarket.cn'
    baseUrlAdmin = 'https://admin.chinamarket.cn'
  }
  return {
    pc: {
      order: `${baseUrlPc}/merchants`,
      detail: `${baseUrlPc}/goods-detail`,
    },
    admin: {
      order: `${baseUrlAdmin}/transaction-management/order-detail`,
      detail: `${baseUrlAdmin}/product-management/product-detail`,
    },
  }
}
const domainsMap = {
  // 本地开发
  'localhost:5100': getChinamarketUrls('development'),
  'localhost:6023': getChinamarketUrls('development'),
  // 中国主站
  'www.chinamarket.cn': getChinamarketUrls('production'),
  'm.chinamarket.cn': getChinamarketUrls('production'),
  'dev.chinamarket.cn': getChinamarketUrls('development'),
  'dev-h5.chinamarket.cn': getChinamarketUrls('development'),
  'staging.chinamarket.cn': getChinamarketUrls('staging'),
  'staging-m.chinamarket.cn': getChinamarketUrls('staging'),

  // 印尼
  'idn.chinamarket.cn': getIdnUrls('production'),
  'idn-m.chinamarket.cn': getIdnUrls('production'),
  'idn-dev.chinamarket.cn': getIdnUrls('development'),
  'idn-dev-m.chinamarket.cn': getIdnUrls('development'),
  'staging-idn.chinamarket.cn': getIdnUrls('staging'),
  'idn-staging-m.chinamarket.cn': getIdnUrls('staging'),

  // 阿联酋
  'uae.chinamarket.cn': getUaeUrls('production'),
  'uae-m.chinamarket.cn': getUaeUrls('production'),
  'dev-uae.chinamarket.cn': getUaeUrls('development'),
  'uae-dev-m.chinamarket.cn': getUaeUrls('development'),
  'uae-staging.chinamarket.cn': getUaeUrls('staging'),
  'uae-staging-m.chinamarket.cn': getUaeUrls('staging'),

  // 全球
  'global.chinamarket.cn': getGlobalUrls('production'),
  'global-dev.chinamarket.cn': getGlobalUrls('development'),
  'global-staging.chinamarket.cn': getGlobalUrls('staging'),

  // 香港
  'hk.chinamarket.cn': getHkUrls('production'),
  'hk-dev.chinamarket.cn': getHkUrls('development'),
  'hk-staging.chinamarket.cn': getHkUrls('staging'),

  // 白沟
  'baigou.chinamarket.cn': getBaigouUrls('production'),
  'baigou-staging.chinamarket.cn': getBaigouUrls('staging'),
  'baigou-dev.chinamarket.cn': getBaigouUrls('development'),
}
```


## 地址跳转判断逻辑

### 参数
* url: 跳转的url
* id: 订单id
* host: 域名
* userType: 用户类型 1 | 2 | 3 | 4 | 5
* from: 来源 order | detail
* is_h5: 是否是h5 0 | 1
* is_workspace: 是否是管理后台 0 | 1

### 实现逻辑

```ts
const { url, id, host, userType, from, is_h5, is_workspace } = options
const isBuyer = userType === '1'
const isSupplier = userType === '2'
let newUrl = url
if (is_workspace === '1') {
  // 管理后台端
  const domain = domainsMap[host] && domainsMap[host] && domainsMap[host]['admin'] ? domainsMap[host] : domainsMap[defaultDomain]
  const workspaceUrl = domain.admin[from]
  newUrl = `${workspaceUrl}`
  let paramsUrl = ''
  if (from === 'order') {
    paramsUrl = `?id=${id}&menuPath=%252Ftransaction-management%252Forder-management`
  }
  if (from === 'detail') {
    paramsUrl = `?id=${id}&type=view&menuPath=%252Fproduct-management`
  }
  newUrl += paramsUrl
} else if (is_h5 === '1') {
  // H5端
  const domain = domainsMap[host] && domainsMap[host] && domainsMap[host]['h5'] ? domainsMap[host] : domainsMap[defaultDomain]
  const h5Url = domain.h5[from]
  newUrl = `${h5Url}?id=${id}`
} else {
  // PC端
  const domain = domainsMap[host] && domainsMap[host] && domainsMap[host]['pc'] ? domainsMap[host] : domainsMap[defaultDomain]
  const pcUrl = domain.pc[from]
  if (from === 'order') {
    // 示例-采购商：https://dev.chinamarket.cn/merchants/buyer-center/order-manage-detail?id=1764053288584072001
    // 示例-供应商：https://dev.chinamarket.cn/merchants/seller-center/order-manage-detail?id=1764054218908072001
    // 外综服服务商: 地址无法获取，默认跳转详情页
    if (isBuyer || isSupplier) {
      newUrl = `${pcUrl}/${isBuyer ? 'buyer-center' : 'seller-center'}/order-manage-detail?id=${id}`
    } else {
      alert('外综服服务商的订单无法跳转！')
      newUrl = `${pcUrl}/redirect_${id}.html`
    }
  }
  if (from === 'detail') {
    // 示例：https://dev.chinamarket.cn/goods-detail/redirect_4176386884640709801.html
    newUrl = `${pcUrl}/redirect_${id}.html`
  }
}
console.log('newUrl', newUrl)
location.href.replace(location.href, newUrl)
```