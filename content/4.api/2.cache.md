---
title: 站点缓存 API 文档
navigation:
  icon: i-lucide-hard-drive
---

## 概述

已实现基于 Redis 的 接口缓存系统，实现以下功能：

- 首次访问进行接口请求并缓存 X 小时
- 后续访问直接从Redis中取，提升响应速度
- 提供缓存管理接口

## 配置说明

### 环境变量

在 `.env` 文件中添加以下配置：

```bash
# SSR 缓存管理员令牌（用于缓存清理接口）
SSR_CACHE_ADMIN_TOKEN=your-secure-admin-token // 暂未使用，考虑做成动态验证
```

## API 接口

### 统一缓存控制（`GET /api/cache`）

`/api/cache` 提供所有缓存操作，通过 `action` 区分具体能力。默认基于当前请求解析租户 ID（也可显式传 `tenantId`），并结合 `nationalType` 拼装缓存键。

| 查询参数 | 必填 | 说明 |
| --- | --- | --- |
| `action` | 是 | 操作类型，见下表 |
| `key` | 否 | 某些操作需要：<br>- 对数据源缓存：`payPriceType`、`priceType`、`marketSeo`、`seoTree`、`firstTitleTdk`<br>- 对 FS 缓存：为要清理的 URL |
| `referer` | 否 | 透传给数据源，覆盖自动识别的 Referer |
| `tenantId` | 否 | 管理租户缓存时指定目标租户，默认当前 |

> 管理操作需要携带 `x-cache-admin-token`，令牌来自 `runtimeConfig.ssrCache.adminToken`（TOKEN可以考虑做动态验证）。

#### 操作与示例

所有示例可直接复制，将 `BASE_URL`、`TENANT_ID`、`ADMIN_TOKEN`、`URL_PATH` 等占位符替换成真实值即可。

##### 1. 拉取（并自动回源）数据源缓存 `action=get`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=get&key=marketSeo" \
  -H "Accept: application/json"
```

##### 2. 删除单个数据源缓存 `action=clear`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear&key=seoTree" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 3. 查看 Redis 缓存统计 `action=stats`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=stats&tenantId=TENANT_ID" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 4. 查看 API LRU 状态 `action=lru-stats`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=lru-stats&tenantId=TENANT_ID" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 5. 查看页面（FS）LRU 状态 `action=fs-lru-stats`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=fs-lru-stats&tenantId=TENANT_ID" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 6. 强制回源刷新数据源缓存 `action=refresh`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=refresh&key=payPriceType" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 7. 清除当前租户所有缓存（Redis + FS + LRU）`action=clear-all`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear-all" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 8. 清除当前租户所有页面缓存 `action=clear-fs-all`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear-fs-all" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 9. 清除单个页面缓存 `action=clear-fs`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear-fs&key=/goods-detail/123" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 10. 清除指定租户缓存 `action=clear-tenant`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear-tenant&tenantId=TENANT_ID" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 11. 清除所有租户缓存 `action=clear-all-tenants`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=clear-all-tenants" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 12. 查看指定租户缓存统计 `action=tenant-stats`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=tenant-stats&tenantId=TENANT_ID" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

##### 13. 列出所有租户 `action=all-tenants-list`
```bash [Terminal]
curl -X GET "$BASE_URL/api/cache?action=all-tenants-list" \
  -H "x-cache-admin-token: $ADMIN_TOKEN"
```

### 日志

SLS会输出缓存相关日志：

```
[Redis_Cache]
[API_Node_Cache_Get]
```

## 更新日志

- 2025-11-25: 租户修改
  - 租户维度获取接口数据

- 2025-10-20: 初始实现
  - 缓存管理接口
